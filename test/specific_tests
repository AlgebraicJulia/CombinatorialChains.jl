Rule 3 works nicely:

  J₀ = @acset IsingModel begin 
    V1 = 8
    V2 = 1
    L1 = 9
    E = 3
    src1 = [2,3,4,6,5,8,1,1,1]
    tgt1 = [3,4,6,7,8,7,3,6,8]
    q = [1,1,1]
    p = [1,2,5]
  end
  to_graphviz(J₀)

  m = homomorphisms(codom(rule(3)[1]), J₀, monic=true)[1]
  J₁ = rewrite_match(rule(3)..., m)
  to_graphviz(J₁)
  
Rule 2 looks good, too. I think the mirroring is just due to labelling.

J₀ = @acset IsingModel begin 
  V1 = 7
  V2 = 2
  L1 = 6
  E = 6
  src1 = [2,3,4,6,1,1]
  tgt1 = [3,4,6,7,3,6]
  p = [1,2,5,1,5,7]
  q = [2,2,2,1,1,1]
end
to_graphviz(J₀)

m = homomorphisms(codom(rule(2)[1]), J₀, monic=true)[1]
J₁ = rewrite_match(rule(2)..., m)
to_graphviz(J₁)

Rule 1 all good:

J₀ = @acset IsingModel begin 
  V1 = 6
  V2 = 3
  L1 = 3
  E = 9
  src1 = [2,3,1]
  tgt1 = [3,4,3]
  p = [1,4,6,1,2,5,1,5,6]
  q = [3,3,3,2,2,2,1,1,1]
end
to_graphviz(J₀)

m = homomorphisms(codom(rule(1)[1]), J₀, monic=true)[1]
J₁ = rewrite_match(rule(1)..., m)
#to_graphviz(codom(ruler(1)))
to_graphviz(J₁)

Rule 0 all good:

J₀ = @acset IsingModel begin 
  V1 = 5
  V2 = 4
  L1 = 0
  E = 12
  p = [1,2,3,1,3,5,1,4,5,1,2,4]
  q = [4,4,4,3,3,3,2,2,2,1,1,1]
end
to_graphviz(J₀)

m = homomorphisms(codom(rule(0)[1]), J₀, monic=true)[1]
J₁ = rewrite_match(rule(0)..., m)
to_graphviz(J₁)

Inverted rule 0 works:
J₀ = @acset IsingModel begin 
  V2 = 9
  V1 = 0
  L2 = 12
  #E = 0
  src2 = [2,3,4,5,2,7,8,9,1,1,1,1]
  tgt2 = [3,4,5,6,7,8,9,6,3,5,7,9]
  #p = [1,1,1]
  #q = [1,2,5]
end
to_graphviz(J₀)

m = homomorphisms(codom(rule(0)[2]), J₀, monic=true)[1]
J₁ = rewrite_match(rule(0)[2], rule(0)[1], m) #switching l and r via [2] and [1]
#to_graphviz(codom(ruler(1)))
to_graphviz(J₁)

Inverted rule 1 works:
J₀ = @acset IsingModel begin 
  V2 = 8
  V1 = 1
  L2 = 9
  E = 3
  src2 = [2,3,4,5,2,7,1,1,1]
  tgt2 = [3,4,5,6,7,8,3,5,7]
  q = [1,6,8]
  p = [1,1,1]
end
to_graphviz(J₀)

m = homomorphisms(codom(rule(1)[2]), J₀, monic=true)[1]
J₁ = rewrite_match(rule(1)[2], rule(1)[1], m) #switching l and r via [2] and [1]
#to_graphviz(codom(ruler(1)))
to_graphviz(J₁)

Rule 2 does not work:
J₀ = @acset IsingModel begin 
  V2 = 7
  V1 = 2
  L2 = 6
  E = 6
  src2 = [2,3,4,5,1,1]
  tgt2 = [3,4,5,6,3,5]
  q = [1,2,7,1,6,7]
  p = [2,2,2,1,1,1]
end
to_graphviz(J₀)

#to_graphviz(codom(rule(2)[2]))

m = homomorphisms(codom(rule(2[2]), J₀, monic=true)[1]
J₁ = rewrite_match(rule(2)[2], rule(2)[1], m) #switching l and r via [2] and [1]

to_graphviz(J₁)
